<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>AR Fixed Object</title>

    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"
    ></script>

    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #0b0c10;
        color: #fff;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        overflow: hidden;
      }

      model-viewer {
        width: 100%;
        height: 100%;
        --ar-button-display: none;
        background: #0b0c10;
      }

      .button-group {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(30px);
        display: flex;
        gap: 16px;
        z-index: 10;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.8s ease, transform 0.8s ease;
      }

      .button-group.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateX(-50%) translateY(0);
      }

      .ar-btn {
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        color: #1a1a1a;
        border: none;
        border-radius: 12px;
        padding: 12px 20px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      .ar-info {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px;
        border-radius: 12px;
        font-size: 14px;
        backdrop-filter: blur(10px);
        z-index: 100;
        display: none;
      }

      .ar-info.show {
        display: block;
      }
    </style>
  </head>

  <body>
    <div class="ar-info" id="arInfo">
      <strong>üéØ AR Mode Active!</strong><br />
      <span id="arInfoText">
        Object is fixed in front of your camera ‚Äî move around, it stays in view.
      </span>
    </div>

    <model-viewer
      id="mv"
      src="1M.glb"
      ios-src="1M.usdz"
      ar
      ar-modes="webxr quick-look"
      ar-scale="auto"
      camera-controls
      autoplay
      alt="Fixed AR Object"
      style="width: 100%; height: 100%;"
    >
    </model-viewer>

    <div class="button-group show">
      <button class="ar-btn" id="customAR">üï∂Ô∏è Xem AR</button>
    </div>

    <script>
      const mv = document.getElementById("mv");
      const customAR = document.getElementById("customAR");
      const arInfo = document.getElementById("arInfo");

      // Khi ng∆∞·ªùi d√πng b·∫•m n√∫t AR
      customAR.addEventListener("click", async () => {
        try {
          await mv.activateAR();
        } catch (err) {
          console.log("Kh√¥ng th·ªÉ k√≠ch ho·∫°t AR:", err);
        }
      });

      // Khi AR session b·∫Øt ƒë·∫ßu
      mv.addEventListener("ar-status", (event) => {
        if (event.detail.status === "session-started") {
          console.log("AR session started");
          arInfo.classList.add("show");

          // L·∫∑p theo m·ªói frame AR ƒë·ªÉ gi·ªØ m√¥ h√¨nh tr∆∞·ªõc camera
          const session = mv.xrSession;
          const refSpace = mv.xrReferenceSpace;
          const viewerSpace = session.requestReferenceSpace
            ? "viewer"
            : refSpace;

          session.requestAnimationFrame(function updateFrame(t, frame) {
            // L·∫•y pose c·ªßa camera (viewer)
            const pose = frame.getViewerPose(refSpace || viewerSpace);
            if (pose) {
              const pos = pose.transform.position;
              const orientation = pose.transform.orientation;

              // ƒê·∫∑t m√¥ h√¨nh c√°ch camera 0.5m ph√≠a tr∆∞·ªõc
              mv.setAttribute(
                "data-position",
                `0 0 -0.5m`
              );
              mv.setAttribute("data-rotation", "0 0 0");
            }
            // Ti·∫øp t·ª•c c·∫≠p nh·∫≠t m·ªói frame
            session.requestAnimationFrame(updateFrame);
          });
        } else if (event.detail.status === "not-presenting") {
          arInfo.classList.remove("show");
        }
      });
    </script>
  </body>
</html>
