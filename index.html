<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>AR Model Viewer</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
      body {
        margin: 0;
        background-color: #000;
        color: white;
        font-family: sans-serif;
        overflow: hidden;
      }

      model-viewer {
        width: 100vw;
        height: 100vh;
        --poster-color: transparent;
      }

      .button-group {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 12px;
        opacity: 0;
        transition: opacity 0.4s ease;
      }

      .button-group.show {
        opacity: 1;
      }

      .ar-btn,
      .link-btn {
        padding: 10px 16px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        backdrop-filter: blur(8px);
        transition: background 0.3s;
      }

      .ar-btn:hover,
      .link-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <model-viewer
      id="mv"
      src="1M.glb"
      ios-src="1M.usdz"
      ar
      ar-modes="webxr quick-look"
      ar-scale="auto"
      ar-placement="floor"
      camera-controls
      disable-pan
      alt="BABY1M"
      exposure="1.1"
      shadow-intensity="1"
      environment-image="neutral"
    ></model-viewer>

    <div class="button-group show" id="btnGroup">
      <button class="ar-btn" id="customAR">
        üï∂Ô∏è Xem AR
      </button>
      <button
        class="link-btn"
        onclick="window.open('https://store.epicgames.com/vi', '_blank')"
      >
        ‚ñ∂Ô∏è Gh√© ThƒÉm
      </button>
    </div>

    <script type="module">
      const mv = document.querySelector("#mv");
      const btnGroup = document.querySelector("#btnGroup");
      const arBtn = document.querySelector("#customAR");

      // Khi b·∫•m "Xem AR" ‚Üí m·ªü AR mode
      arBtn.addEventListener("click", () => {
        mv.activateAR();
      });

      // Khi model ƒë√£ t·∫£i xong ‚Üí hi·ªán nh√≥m n√∫t (n·∫øu ch∆∞a c√≥ class)
      mv.addEventListener("load", () => {
        btnGroup.classList.add("show");
      });

      // === Di chuy·ªÉn model theo camera trong AR (Android WebXR) ===
      mv.addEventListener("ar-status", (event) => {
        if (event.detail.status === "session-started") {
          const scene = mv.scene;
          const camera = scene.camera;
          const model = mv.model;

          const update = () => {
            if (mv.getAttribute("ar-status") !== "session-started") return;

            const forward = new THREE.Vector3(0, 0, -1);
            forward.applyQuaternion(camera.quaternion);
            forward.multiplyScalar(1.0); // kho·∫£ng c√°ch 1m

            model.position.copy(camera.position).add(forward);
            model.quaternion.copy(camera.quaternion); // h∆∞·ªõng theo camera

            requestAnimationFrame(update);
          };
          update();
        }
      });
    </script>
  </body>
</html>
