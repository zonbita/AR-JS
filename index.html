<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#0b0c10"/>
  <title>Robot AR + Sound (Kenh14.vn)</title>

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root { color-scheme: dark; }
    html, body {
      height: 100%; margin: 0;
      background: #0b0c10; color: #fff;
      font-family: system-ui, -apple-system, Roboto, 'Segoe UI', Arial;
    }
    .wrap { position: relative; height: 100vh; overflow: hidden; }

    model-viewer {
      width: 100%; height: 100%; display: block;
      background: #0b0c10; --poster-color: #0b0c10;
    }

    /* AR button */
    button[slot="ar-button"]{
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      padding: 12px 100px; font-size: 16px; font-weight: 600;
      border-radius: 12px; border: none; cursor: pointer;
      background: #ffe66d; color: #1b1e23; box-shadow: 0 6px 20px rgba(255,230,109,.35);
      z-index: 20;
    }
    button[slot="ar-button"]:active { transform: translateX(-50%) scale(.97); }

    /* Audio controls */
    .audio-controls {
      position: absolute; bottom: 92px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 8px; align-items: center;
      background: rgba(255,255,255,0.05); padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.06); backdrop-filter: blur(6px);
      z-index: 20;
    }
    .audio-controls button {
      background: transparent; border: 1px solid rgba(255,255,255,0.08);
      color: #fff; padding: 6px 10px; border-radius: 8px; cursor: pointer;
    }
    .audio-controls button:active { transform: scale(.98); }

    /* Notice */
    .notice {
      position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
      background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.15);
      padding: 8px 12px; border-radius: 10px; backdrop-filter: blur(8px);
      font-size: 13px; line-height: 1.2; z-index: 20;
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="notice" class="notice hidden">üîé ƒêang ki·ªÉm tra h·ªó tr·ª£ AR‚Ä¶</div>

    <model-viewer id="mv"
      src="https://raw.githubusercontent.com/zonbita/AR-JS/main/abc.glb"
  ios-src="https://raw.githubusercontent.com/zonbita/AR-JS/main/dance.usdz#custom=https://kenh14.vn&customHeight=medium""
  alt="Robot Expressive"
      ar
      ar-modes="webxr scene-viewer quick-look"
      ar-scale="auto"
      camera-controls
      exposure="1"
      shadow-intensity="1"
      shadow-softness="0.6"
      autoplay
      animation-loop="false"
      tone-mapping="aces"
        interaction-prompt="auto"
  interaction-prompt-threshold="3000"
      placeOnWall=true
initialViewingMode=ar
    >
      <!-- N√∫t m·ªü AR -->
      <button slot="ar-button" id="arBtn">üöÄ Xem trong AR</button>

    </model-viewer>

    <!-- Quick Look Call-to-Action (opens Kenh14.vn) -->

    <!-- Audio controls -->
  </div>

  <!-- Nh·∫°c n·ªÅn -->
  <audio id="bgm" src="music.mp3" preload="auto" loop></audio>

  <script>
    (function(){
      const mv = document.getElementById('mv');
      const bgm = document.getElementById('bgm');
      const notice = document.getElementById('notice');
      const arBtn = document.getElementById('arBtn');
      const playBtn = document.getElementById('playBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const audioState = document.getElementById('audioState');

      const isSecure = () => location.protocol === 'https:' || location.hostname === 'localhost';
      const isIOS = () => /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

      function show(msg, ms=2200){
        notice.textContent = msg;
        notice.classList.remove('hidden');
        clearTimeout(show._t);
        show._t = setTimeout(()=> notice.classList.add('hidden'), ms);
      }

      if (!isSecure()) {
        show('‚ö†Ô∏è H√£y ch·∫°y tr√™n HTTPS (ho·∫∑c localhost) ƒë·ªÉ b·∫≠t AR.');
      } else {
        show('‚úÖ Thi·∫øt b·ªã s·∫µn s√†ng. Nh·∫•n ‚ÄúXem trong AR‚Äù ho·∫∑c Play nh·∫°c.', 2000);
      }

      mv.addEventListener('load', () => {
        const anims = mv.availableAnimations || [];
        if (anims.length) {
          const chosen = anims.includes("Dance") ? "Dance" : anims[0];
          mv.animationName = chosen;
          mv.loop = true;
          mv.timeScale = 1;
          if (mv.play) mv.play();
        }
      });

      function setAudioState(text){ audioState.textContent = text; }

      playBtn.addEventListener('click', async () => {
        try { await bgm.play(); setAudioState('ƒêang ph√°t'); }
        catch { setAudioState('B·ªã ch·∫∑n'); }
      });
      pauseBtn.addEventListener('click', () => { bgm.pause(); setAudioState('T·∫°m d·ª´ng'); });

      arBtn.addEventListener('click', () => {
        bgm.play().then(()=> setAudioState('ƒêang ph√°t')).catch(()=> setAudioState('B·ªã ch·∫∑n'));
        if (isIOS()) show('üì≤ iOS Quick Look kh√¥ng cho nh·∫°c web ch·∫°y trong AR.', 2500);
      });

      mv.addEventListener("ar-status", e => {
        const s = e.detail.status;
        if (s === "session-started") {
          if (navigator.vibrate) navigator.vibrate(20);
          bgm.currentTime = 0;
          bgm.play().then(()=> setAudioState('ƒêang ph√°t')).catch(()=> setAudioState('B·ªã ch·∫∑n'));
        } else if (s==="not-presenting" || s==="failed") {
          bgm.pause(); bgm.currentTime = 0; setAudioState('T·∫Øt');
        }
      });

      document.addEventListener('visibilitychange', () => {
        if (document.hidden) { bgm.pause(); setAudioState('T·∫°m d·ª´ng'); }
      });

      mv.addEventListener('error', (e) => {
        console.warn('[model-viewer] error:', e?.detail || e);
        show('‚ö†Ô∏è L·ªói model-viewer. Xem console.', 3000);
      });

      setAudioState('T·∫Øt');
    })();
  </script>
</body>
</html>





















