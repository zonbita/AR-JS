<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>3D UI Autoplay Animation</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
      html, body {
        margin: 0;
        overflow: hidden;
        background: #000;
        height: 100%;
      }

      /* N·ªÅn camera */
      video#camera {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 0;
      }

      /* Model 3D n·∫±m gi·ªØa m√†n h√¨nh */
      model-viewer {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        transform: translate(-50%, -50%);
        z-index: 1;
        background: transparent;
      }

      /* Overlay y√™u c·∫ßu b·∫≠t ti·∫øng */
      #tapOverlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        font-size: 1.5em;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        z-index: 10;
        transition: opacity 0.6s ease;
      }
      #tapOverlay.hidden {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <!-- Camera n·ªÅn -->
    <video id="camera" autoplay muted playsinline></video>

    <!-- 3D model lu√¥n ·ªü gi·ªØa -->
    <model-viewer
      id="obj"
      src="embe5.glb"
      ios-src="embe5.usdz"
      camera-controls
      auto-rotate
      autoplay
      interaction-prompt="none"
      shadow-intensity="1"
      exposure="1"
      touch-action="pan-y"
    ></model-viewer>

    <!-- Nh·∫°c n·ªÅn -->
    <audio id="bgm" src="voice_embe5.MP3" preload="auto" loop></audio>

    <!-- Overlay ‚Äúch·∫°m ƒë·ªÉ b·∫≠t ti·∫øng‚Äù -->
    <div id="tapOverlay">üîä Ch·∫°m ƒë·ªÉ b·∫≠t ti·∫øng</div>

    <script>
      const cameraVideo = document.getElementById("camera");
      const mv = document.getElementById("obj");
      const bgm = document.getElementById("bgm");
      const tapOverlay = document.getElementById("tapOverlay");

      // B·∫≠t camera m√¥i tr∆∞·ªùng (AR background)
      navigator.mediaDevices
        .getUserMedia({ video: { facingMode: "environment" } })
        .then((stream) => (cameraVideo.srcObject = stream))
        .catch((err) => console.error("L·ªói m·ªü camera:", err));

      // Ch·∫°y animation sau khi model load
      mv.addEventListener("load", () => {
        if (mv.availableAnimations?.length > 0) {
          mv.play({ animationName: mv.availableAnimations[0] });
        }
      });

      // Th·ª≠ autoplay nh·∫°c (Android, PC)
      bgm.play().then(() => {
        tapOverlay.classList.add("hidden"); // N·∫øu autoplay ƒë∆∞·ª£c ‚Üí ·∫©n overlay
      }).catch(() => {
        // N·∫øu b·ªã ch·∫∑n (iOS) ‚Üí ch·ªù user ch·∫°m ƒë·ªÉ b·∫≠t
        console.log("Autoplay b·ªã ch·∫∑n, ch·ªù ng∆∞·ªùi d√πng t∆∞∆°ng t√°c.");
        const enableAudio = () => {
          bgm.play().catch(err => console.log("Kh√¥ng th·ªÉ b·∫≠t nh·∫°c:", err));
          tapOverlay.classList.add("hidden");
          document.removeEventListener("touchstart", enableAudio);
          document.removeEventListener("click", enableAudio);
        };
        document.addEventListener("touchstart", enableAudio);
        document.addEventListener("click", enableAudio);
      });
    </script>
  </body>
</html>
